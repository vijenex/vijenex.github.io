<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Authenticate GitHub Actions to GCP using Workload Identity Federation ‚Äî Vijenex‚Ñ¢ Blog</title>
  <meta name="description" content="Learn how to securely authenticate GitHub Actions to Google Cloud Platform using Workload Identity Federation without service account keys." />
  <link rel="icon" href="../assets/logo-icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/style.css" />
  <style>
    .blog-post { max-width: 800px; margin: 0 auto; padding: 60px 24px; }
    .blog-post h1 { font-size: 42px; margin-bottom: 16px; line-height: 1.2; }
    .blog-meta { color: var(--text-secondary); margin-bottom: 32px; display: flex; gap: 16px; flex-wrap: wrap; font-size: 14px; }
    .blog-tag { background: var(--accent-primary); color: white; padding: 4px 12px; border-radius: 4px; font-weight: 600; }
    .blog-content { line-height: 1.8; }
    .blog-content h2 { margin-top: 40px; margin-bottom: 16px; font-size: 32px; }
    .blog-content h3 { margin-top: 32px; margin-bottom: 12px; font-size: 24px; }
    .blog-content p { margin-bottom: 20px; color: var(--text-secondary); }
    .blog-content code { background: var(--bg-card); padding: 2px 8px; border-radius: 4px; font-size: 14px; color: #e6f3ff; }
    .blog-content pre { background: var(--bg-card); padding: 20px; border-radius: 8px; overflow-x: auto; margin: 24px 0; border: 1px solid var(--border-color); }
    .blog-content pre code { background: none; padding: 0; }
    .blog-content ul, .blog-content ol { margin-bottom: 20px; padding-left: 24px; color: var(--text-secondary); }
    .blog-content li { margin-bottom: 8px; }
    .blog-content strong { color: var(--text-primary); font-weight: 700; }
    .blog-content a { color: var(--accent-primary); text-decoration: none; }
    .blog-content a:hover { text-decoration: underline; }
    .author-box { background: var(--bg-card); padding: 24px; border-radius: 12px; margin-top: 48px; border: 1px solid var(--border-color); }
    .author-box h3 { margin-bottom: 12px; }
  </style>
</head>
<body class="theme-dark">
  <header class="topbar">
    <div class="inner">
      <a class="brand" href="/">
        <img src="../assets/logo-icon.png" alt="Vijenex" class="logo-icon">
        <span class="brand-text">Vijenex<sup>‚Ñ¢</sup></span>
      </a>
      <nav class="nav">
        <a href="/#tools">Tools</a>
        <a href="/#integrations">Integrations</a>
        <a href="/blog/">Blog</a>
        <a href="/#contribute">Contribute</a>
        <a class="btn small" href="https://github.com/vijenex" target="_blank" rel="noopener noreferrer">GitHub</a>
        <button id="themeToggle" aria-label="Toggle theme" class="theme-btn">‚òÄÔ∏è</button>
      </nav>
    </div>
  </header>

  <article class="blog-post">
    <h1>Authenticate GitHub Actions to GCP using Workload Identity Federation</h1>
    <div class="blog-meta">
      <span class="blog-tag">Cloud Security</span>
      <span>üìÖ Jan 15, 2025</span>
      <span>üë§ skorra</span>
      <span>‚è±Ô∏è 8 min read</span>
    </div>

    <div class="blog-content">
      <h2>Introduction</h2>
      <p>Workload Identity Federation allows you to authenticate GitHub Actions to Google Cloud Platform (GCP) without using long-lived service account keys. This approach enhances security by eliminating the need to store and manage sensitive credentials.</p>

      <h2>Prerequisites</h2>
      <ul>
        <li>A GCP project with billing enabled</li>
        <li>GitHub repository with Actions enabled</li>
        <li>GCP CLI (<code>gcloud</code>) installed</li>
        <li>Appropriate IAM permissions in GCP</li>
      </ul>

      <h2>Step 1: Enable Required APIs</h2>
      <p>First, enable the necessary GCP APIs:</p>
      <pre><code>gcloud services enable iamcredentials.googleapis.com
gcloud services enable sts.googleapis.com
gcloud services enable cloudresourcemanager.googleapis.com</code></pre>

      <h2>Step 2: Create a Workload Identity Pool</h2>
      <p>Create a workload identity pool for GitHub Actions:</p>
      <pre><code>gcloud iam workload-identity-pools create "github-pool" \
  --project="YOUR_PROJECT_ID" \
  --location="global" \
  --display-name="GitHub Actions Pool"</code></pre>

      <h2>Step 3: Create a Workload Identity Provider</h2>
      <p>Configure the provider to trust GitHub's OIDC tokens:</p>
      <pre><code>gcloud iam workload-identity-pools providers create-oidc "github-provider" \
  --project="YOUR_PROJECT_ID" \
  --location="global" \
  --workload-identity-pool="github-pool" \
  --display-name="GitHub Provider" \
  --attribute-mapping="google.subject=assertion.sub,attribute.actor=assertion.actor,attribute.repository=assertion.repository" \
  --issuer-uri="https://token.actions.githubusercontent.com"</code></pre>

      <h2>Step 4: Create a Service Account</h2>
      <p>Create a service account that GitHub Actions will impersonate:</p>
      <pre><code>gcloud iam service-accounts create github-actions-sa \
  --project="YOUR_PROJECT_ID" \
  --display-name="GitHub Actions Service Account"</code></pre>

      <h2>Step 5: Grant IAM Permissions</h2>
      <p>Grant necessary permissions to the service account:</p>
      <pre><code># Example: Grant Storage Admin role
gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:github-actions-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/storage.admin"</code></pre>

      <h2>Step 6: Allow Workload Identity Federation</h2>
      <p>Allow the workload identity pool to impersonate the service account:</p>
      <pre><code>gcloud iam service-accounts add-iam-policy-binding \
  github-actions-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com \
  --project="YOUR_PROJECT_ID" \
  --role="roles/iam.workloadIdentityUser" \
  --member="principalSet://iam.googleapis.com/projects/PROJECT_NUMBER/locations/global/workloadIdentityPools/github-pool/attribute.repository/YOUR_GITHUB_ORG/YOUR_REPO"</code></pre>

      <h2>Step 7: Configure GitHub Actions Workflow</h2>
      <p>Create a workflow file (<code>.github/workflows/deploy.yml</code>):</p>
      <pre><code>name: Deploy to GCP

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - id: 'auth'
        uses: 'google-github-actions/auth@v1'
        with:
          workload_identity_provider: 'projects/PROJECT_NUMBER/locations/global/workloadIdentityPools/github-pool/providers/github-provider'
          service_account: 'github-actions-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com'
      
      - name: 'Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v1'
      
      - name: 'Use gcloud CLI'
        run: 'gcloud info'</code></pre>

      <h2>Security Best Practices</h2>
      <ul>
        <li><strong>Principle of Least Privilege:</strong> Grant only necessary permissions to the service account</li>
        <li><strong>Repository Restrictions:</strong> Limit workload identity to specific repositories</li>
        <li><strong>Branch Protection:</strong> Use branch protection rules to control deployments</li>
        <li><strong>Audit Logging:</strong> Enable Cloud Audit Logs to monitor authentication events</li>
        <li><strong>Regular Reviews:</strong> Periodically review and rotate service account permissions</li>
      </ul>

      <h2>Troubleshooting</h2>
      <h3>Common Issues</h3>
      <ul>
        <li><strong>Permission Denied:</strong> Verify IAM bindings and service account permissions</li>
        <li><strong>Invalid Token:</strong> Check workload identity pool configuration</li>
        <li><strong>Repository Mismatch:</strong> Ensure repository name matches the IAM policy binding</li>
      </ul>

      <h2>Conclusion</h2>
      <p>Workload Identity Federation provides a secure, keyless authentication method for GitHub Actions to access GCP resources. By eliminating long-lived credentials, you significantly reduce the attack surface and improve your security posture.</p>

      <h2>Additional Resources</h2>
      <ul>
        <li><a href="https://cloud.google.com/iam/docs/workload-identity-federation" target="_blank" rel="noopener noreferrer">GCP Workload Identity Federation Documentation</a></li>
        <li><a href="https://github.com/google-github-actions/auth" target="_blank" rel="noopener noreferrer">Google GitHub Actions Auth</a></li>
        <li><a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect" target="_blank" rel="noopener noreferrer">GitHub Actions OIDC</a></li>
      </ul>

      <div class="author-box">
        <h3>About the Author</h3>
        <p><strong>skorra</strong> - Cloud Security Engineer specializing in DevSecOps automation and multi-cloud security implementations.</p>
      </div>
    </div>
  </article>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-bottom">
        <p>¬© 2025 Vijenex‚Ñ¢. All rights reserved. <a href="/blog/">‚Üê Back to Blog</a></p>
      </div>
    </div>
  </footer>

  <script src="../assets/script.js"></script>
</body>
</html>
